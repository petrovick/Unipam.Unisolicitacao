<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:p="http://primefaces.org/ui"
      xmlns:f="http://java.sun.com/jsf/core" >
    <ui:composition template="/template/template.xhtml">
    	<ui:define name="container">
				<h:form id="formSolicitacao">
					<p:panel header="Propriedades" id="painelSolicitacao" >
						<p:growl id="message" showDetail="false"/>
						
						<h:panelGrid columns="3"  cellpadding="20">
							<h:outputLabel value="Nº Solicitacao" />
							<h:outputLabel value="Data Solicitação" />
							<h:outputLabel value="Anexo" />
							
							<h:outputLabel value="#{solicitacaoController.solicitacao.idSolicitacao}" />
							<h:outputLabel value="#{solicitacaoController.solicitacao.dataSolicitacao}" />
							<p:panelGrid columns="1">
								<ui:repeat var="anexo" value="#{solicitacaoController.solicitacao.anexos}">
									<b>#{anexo.conteudoDoAnexo}</b>
								</ui:repeat>
							</p:panelGrid>
							
						</h:panelGrid>
						<h:panelGrid columns="3"  cellpadding="20">
							<h:outputLabel value="Solicitante" />
							<h:outputLabel value="Data Desejada" />
							<h:outputLabel value="Prioridade" />
							<h:outputLabel value="#{solicitacaoController.solicitacao.setorByIdSetorOrigem.nomeSetor}"/>
							<h:outputLabel value="#{solicitacaoController.solicitacao.dataDesejada}"><h:outputLabel value="#{solicitacaoController.solicitacao.prioridade.descricao}" /></h:outputLabel>
							
						</h:panelGrid>
						<h:panelGrid columns="1">
							<h:outputLabel value="Assunto"/>
							<h:inputTextarea value="#{solicitacaoController.solicitacao.descAssunto}"/>
							<h:outputLabel value="Descricao"/>
							<h:inputTextarea value="#{solicitacaoController.solicitacao.descProblema}"/>
						</h:panelGrid>
				
			                 
                    	<!-- Essa parte vai gerar o atendimento -->
                    		
						<!-- Verificar o process="@this" do Gerar Atendimento -->
						<p:commandButton value="Gerar Atendimento"
			                actionListener="#{solicitacaoController.gerarAtendimento(solicitacaoController.solicitacao)}"
			                update=":formAtendimento:atendimento"
			                />
						<!-- Verificar o process="@this" do Gerar Atendimento -->
						<p:commandButton value="Recusado"
			                actionListener="#{solicitacaoController.recusarSolicitacao()}"
			                
			                />
                	</p:panel>
				</h:form>
				<h:form id="formAtendimento">				
				<p:outputPanel id="atendimento" >
					
						<p:panel rendered="#{solicitacaoController.solicitacao.situacao.idSituacao == 2}" header="Atendimento">
							<h:panelGrid columns="2" >
								
								Teste - #{solicitacaoController.solicitacao.descAssunto}
	                    		<h:outputText value="Previsão Início Atendimento*:" />
						        <p:calendar required="true" value="#{atendimentoController.atendimento.dataInicioAtendimento}" id="dataInicioAtendimento" showOn="button" />
						        
						        <h:outputText value="Previsão Fim Atendimento:" />
						        <p:calendar required="true" value="#{atendimentoController.atendimento.dataFimAtendimento}" id="dataFimAtendimento" showOn="button" />
						        
		                    	<p:commandButton
					                value="Salvar"
					                icon="ui-icon-disk" 
					                actionListener="#{atendimentoController.salvar(solicitacaoController.solicitacao)}" 
					                 />
								
	                   	</h:panelGrid>
					</p:panel>
				
			</p:outputPanel>
		 
		    <p:growl id="messages" showDetail="true"/>
			
			
		    <p:dataTable tableStyleClass="grid" selectionMode="single" rowKey="#{car.idAtendimento}" 
		    value="#{atendimentoController.listarAtendimentoPorSolicitacao(solicitacaoController.solicitacao)}" 
		    var="car"  emptyMessage="Nenhum Atendimento" editable="true">
		 
		        <f:facet name="header">
		            Atendimentos
		        </f:facet>
		 
		        <p:ajax event="rowEdit" listener="#{atendimentoController.onEdit}" update=":formAtendimento:messages" />
		        <p:ajax event="rowEditCancel" listener="#{atendimentoController.onCancel}" update=":formAtendimento:messages" />
		        
		        <p:column headerText="Fim Atendimento" style="width:30%">
		            <p:cellEditor>
		                <f:facet name="output">
		                    <p:calendar value="#{car.dataFimAtendimento}" style="width:100%" />
		                </f:facet>
		                <f:facet name="input">
		                    <p:calendar value="#{car.dataFimAtendimento}" style="width:100%" />
		                </f:facet>
		            </p:cellEditor>
		        </p:column>
		        
		        <p:column headerText="Descrição" style="width:30%">
		            <p:cellEditor>
		                <f:facet name="output">
		                    <h:outputText value="#{car.descAtendimento}" />
		                </f:facet>
		                <f:facet name="input">
		                    <p:inputText value="#{car.descAtendimento}" style="width:100%"/>
		                </f:facet>
		            </p:cellEditor>
		        </p:column>
		 
		        <p:column headerText="Início Atendimento" style="width:20%">
		            <p:cellEditor>
		                <f:facet name="output">
		                	<p:calendar value="#{car.dataInicioAtendimento}" />
		                </f:facet>
		                <f:facet name="input">
		                	<p:calendar value="#{car.dataInicioAtendimento}" style="width:100%" label="Year"/>
		                </f:facet>
		            </p:cellEditor>
		        </p:column>
		 
		        
		        <p:column style="width:6%">
		            <p:rowEditor />
		        </p:column>
		 
		    </p:dataTable>

			</h:form>
    	</ui:define>
    </ui:composition>
</html>